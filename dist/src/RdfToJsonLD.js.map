{"version":3,"sources":["../../src/RdfToJsonLD.js"],"names":["RdfToJsonLD","tempJsonLd","subject","predicate","objectIndex","list","node","undefined","push","rdfText","Promise","resolve","reject","env","environment","expand","value","indexOf","toString","console","log","graph","createGraph","turtleParser","TurtleParser","parse","forEach","triple","nodeType","nominalValue","object","type","datatype","resolvedDatatype","language","Object","keys","map","key","filter","Array","isArray","convertRdfListToArray","realJsonLd"],"mappings":";;;;;;;;AAAA;;;;;;;;IAEMA,W;;;;;;;8CAG2BC,U,EAAYC,O,EAASC,S,EAAWC,W,EAAa;;AAEtE,gBAAIC,OAAO,EAAX;;AAEA,gBAAIC,OAAOL,WAAWC,QAAQC,SAAR,EAAmBC,WAAnB,EAAgC,KAAhC,CAAX,CAAX;;AAEA,mBAAOE,SAASC,SAAhB,EAA2B;;AAEvBF,qBAAKG,IAAL,CAAUF,KAAK,kDAAL,EAAyD,CAAzD,CAAV;;AAEAA,uBAAOL,WAAWK,KAAK,iDAAL,EAAwD,CAAxD,EAA2D,KAA3D,CAAX,CAAP;AAGH;;AAEDJ,oBAAQC,SAAR,EAAmBC,WAAnB,IAAkC,EAAC,SAASC,IAAV,EAAlC;AAGH;;;oCAGkBI,O,EAAS;AACxB,mBAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;;AAG1C,oBAAMC,MAAM,cAAIC,WAAhB;;AAEA,yBAASC,MAAT,CAAgBC,KAAhB,EAAuB;AACnB,wBAAGA,MAAMC,OAAN,CAAc,GAAd,IAAmB,CAAnB,IAAwBD,MAAMC,OAAN,CAAc,IAAd,KAAqB,CAAhD,EAAoD,OAAOD,MAAME,QAAN,EAAP;AACpD,2BAAOL,IAAIF,OAAJ,CAAYK,KAAZ,KAAoBA,MAAME,QAAN,EAA3B;AACH;;AAED;;AAEAC,wBAAQC,GAAR,CAAY,aAAZ;;AAEA,oBAAIC,QAAQR,IAAIS,WAAJ,EAAZ;AACA,oBAAIC,eAAe,IAAI,cAAIC,YAAR,EAAnB;AACAD,6BAAaE,KAAb,CAAmBhB,OAAnB,EAA4B,YAAY;;AAEpCU,4BAAQC,GAAR,CAAY,cAAZ;AACA,wBAAInB,aAAa,EAAjB;;AAEAoB,0BAAMK,OAAN,CAAc,kBAAU;AACpB;AACA,4BAAGC,OAAOzB,OAAP,CAAe0B,QAAf,OAA8B,WAA9B,IAA6CD,OAAOzB,OAAP,CAAe2B,YAAf,CAA4BZ,OAA5B,CAAoC,IAApC,IAA4C,CAA5F,EAA8F;AAC1FU,mCAAOzB,OAAP,CAAe2B,YAAf,GAA8B,OAAKF,OAAOzB,OAAP,CAAe2B,YAAlD;AAEH;AACD;;AAEA,4BAAI,CAAC5B,WAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,CAAL,EAA8C;AAC1C5B,uCAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,IAA0C,EAAC,OAAOF,OAAOzB,OAAP,CAAe2B,YAAvB,EAA1C;AACH;;AAED,4BAAIF,OAAOxB,SAAP,CAAiB0B,YAAjB,KAAkC,iDAAtC,EAAyF;AACrF,gCAAI,CAAC5B,WAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,EAAwC,OAAxC,CAAL,EAAuD;AACnD5B,2CAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,EAAwC,OAAxC,IAAmD,EAAnD;AACH;;AAED5B,uCAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,EAAwC,OAAxC,EAAiDrB,IAAjD,CAAsDmB,OAAOG,MAAP,CAAcD,YAApE;AAGH;;AAED,4BAAI,CAAC5B,WAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,EAAwCF,OAAOxB,SAAP,CAAiB0B,YAAzD,CAAL,EAA6E;AACzE5B,uCAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,EAAwCF,OAAOxB,SAAP,CAAiB0B,YAAzD,IAAyE,EAAzE;AACH;;AAED,4BAAIC,SAAS,EAAb;;AAEA,4BAAIC,OAAOJ,OAAOG,MAAP,CAAcF,QAAd,EAAX;;AAGA,4BAAIG,SAAS,KAAb,EAAoB;AAChBD,mCAAO,KAAP,IAAgBH,OAAOG,MAAP,CAAcD,YAA9B;AACH,yBAFD,MAEO,IAAGE,SAAS,WAAZ,EAAwB;AAC3B,gCAAGJ,OAAOG,MAAP,CAAcD,YAAd,CAA2BZ,OAA3B,CAAmC,IAAnC,IAA2C,CAA9C,EAAgD;AAC5Ca,uCAAO,KAAP,IAAgB,OAAKH,OAAOG,MAAP,CAAcD,YAAnC;AACH,6BAFD,MAEK;AACDC,uCAAO,KAAP,IAAgBH,OAAOG,MAAP,CAAcD,YAA9B;AAEH;AACJ,yBAPM,MAOA;AACHC,mCAAO,QAAP,IAAmBH,OAAOG,MAAP,CAAcD,YAAjC;AACA,gCAAIF,OAAOG,MAAP,CAAcE,QAAlB,EAA4B;;AAExB,oCAAIC,mBAAkBlB,OAAOY,OAAOG,MAAP,CAAcE,QAArB,CAAtB;AACAF,uCAAO,OAAP,IAAkBG,gBAAlB;AAEH;AACD,gCAAIN,OAAOG,MAAP,CAAcI,QAAlB,EAA4B;AACxBJ,uCAAO,WAAP,IAAsBH,OAAOG,MAAP,CAAcI,QAApC;AACH;AACJ;;AAGDjC,mCAAW0B,OAAOzB,OAAP,CAAe2B,YAA1B,EAAwCF,OAAOxB,SAAP,CAAiB0B,YAAzD,EAAuErB,IAAvE,CAA4EsB,MAA5E;AAGH,qBAzDD;;AA2DAX,4BAAQC,GAAR,CAAY,cAAZ;;AAEAe,2BACKC,IADL,CACUnC,UADV,EAEKoC,GAFL,CAES;AAAA,+BAAOpC,WAAWqC,GAAX,CAAP;AAAA,qBAFT,EAGKC,MAHL,CAGY;AAAA,+BAAWrC,QAAQ,kDAAR,MAAgEK,SAA3E;AAAA,qBAHZ,EAIKmB,OAJL,CAIa,mBAAW;;AAEhBS,+BAAOC,IAAP,CAAYlC,OAAZ,EACKqC,MADL,CACY;AAAA,mCAAaC,MAAMC,OAAN,CAAcvC,QAAQC,SAAR,CAAd,CAAb;AAAA,yBADZ,EAEKuB,OAFL,CAEa,qBAAa;AAClB,iCAAK,IAAItB,WAAT,IAAwBF,QAAQC,SAAR,CAAxB,EAA4C;AACxC,oCAAI2B,SAAS5B,QAAQC,SAAR,EAAmBC,WAAnB,CAAb;AACA,oCAAI0B,OAAO,KAAP,MAAkBvB,SAAtB,EAAiC;;AAEjC,oCAAIN,WAAW6B,OAAO,KAAP,CAAX,MAA8BvB,SAA9B,IAA2CN,WAAW6B,OAAO,KAAP,CAAX,EAA0B,kDAA1B,MAAkFvB,SAAjI,EAA4I;AACxIP,gDAAY0C,qBAAZ,CAAkCzC,UAAlC,EAA8CC,OAA9C,EAAuDC,SAAvD,EAAkEC,WAAlE;AACH;AAEJ;AAGJ,yBAdL;AAeH,qBArBL;;AAwBA,wBAAIuC,aAAa,EAAjB;;AAEAR,2BAAOC,IAAP,CAAYnC,UAAZ,EACKsC,MADL,CACY;AAAA,+BAAOtC,WAAWqC,GAAX,EAAgB,kDAAhB,MAAwE/B,SAA/E;AAAA,qBADZ,EAEKmB,OAFL,CAEa;AAAA,+BAAOiB,WAAWnC,IAAX,CAAgBP,WAAWqC,GAAX,CAAhB,CAAP;AAAA,qBAFb;;AAIAnB,4BAAQC,GAAR,CAAY,gBAAZ;;AAGAT,4BAAQgC,UAAR;AAEH,iBArGD,EAqGG,EArGH,EAqGO,IArGP,EAqGatB,KArGb;AAyGH,aAzHM,CAAP;AA0HH;;;;;;kBAOUrB,W","file":"RdfToJsonLD.js","sourcesContent":["import rdf from \"rdf\";\n\nclass RdfToJsonLD {\n\n\n    static convertRdfListToArray(tempJsonLd, subject, predicate, objectIndex) {\n\n        let list = [];\n\n        let node = tempJsonLd[subject[predicate][objectIndex][\"@id\"]];\n\n        while (node !== undefined) {\n\n            list.push(node[\"http://www.w3.org/1999/02/22-rdf-syntax-ns#first\"][0]);\n\n            node = tempJsonLd[node[\"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest\"][0][\"@id\"]];\n\n\n        }\n\n        subject[predicate][objectIndex] = {\"@list\": list};\n\n\n    }\n\n\n    static rdfToJsonld(rdfText) {\n        return new Promise(function (resolve, reject) {\n\n\n            const env = rdf.environment;\n\n            function expand(value) {\n                if(value.indexOf(':')<0 || value.indexOf(\"//\")>=0 ) return value.toString();\n                return env.resolve(value)||value.toString();\n            };\n\n            // rdf.setBuiltins();\n\n            console.log(\"start parse\")\n\n            let graph = env.createGraph();\n            let turtleParser = new rdf.TurtleParser();\n            turtleParser.parse(rdfText, function () {\n\n                console.log(\"done parsing\")\n                let tempJsonLd = {};\n\n                graph.forEach(triple => {\n                    // triple.subject.nominalValue = triple.subject.nominalValue.resolve();\n                    if(triple.subject.nodeType() === \"BlankNode\" && triple.subject.nominalValue.indexOf(\"_:\") < 0){\n                        triple.subject.nominalValue = \"_:\"+triple.subject.nominalValue;\n\n                    }\n                    // triple.predicate.nominalValue = triple.predicate.nominalValue.resolve();\n\n                    if (!tempJsonLd[triple.subject.nominalValue]) {\n                        tempJsonLd[triple.subject.nominalValue] = {\"@id\": triple.subject.nominalValue};\n                    }\n\n                    if (triple.predicate.nominalValue === \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\") {\n                        if (!tempJsonLd[triple.subject.nominalValue][\"@type\"]) {\n                            tempJsonLd[triple.subject.nominalValue][\"@type\"] = [];\n                        }\n\n                        tempJsonLd[triple.subject.nominalValue][\"@type\"].push(triple.object.nominalValue);\n\n\n                    }\n\n                    if (!tempJsonLd[triple.subject.nominalValue][triple.predicate.nominalValue]) {\n                        tempJsonLd[triple.subject.nominalValue][triple.predicate.nominalValue] = [];\n                    }\n\n                    let object = {};\n\n                    let type = triple.object.nodeType();\n\n\n                    if (type === \"IRI\") {\n                        object[\"@id\"] = triple.object.nominalValue;\n                    } else if(type === \"BlankNode\"){\n                        if(triple.object.nominalValue.indexOf(\"_:\") < 0){\n                            object[\"@id\"] = \"_:\"+triple.object.nominalValue;\n                        }else{\n                            object[\"@id\"] = triple.object.nominalValue;\n\n                        }\n                    } else {\n                        object[\"@value\"] = triple.object.nominalValue;\n                        if (triple.object.datatype) {\n\n                            let resolvedDatatype =expand(triple.object.datatype);\n                            object[\"@type\"] = resolvedDatatype;\n\n                        }\n                        if (triple.object.language) {\n                            object[\"@language\"] = triple.object.language;\n                        }\n                    }\n\n\n                    tempJsonLd[triple.subject.nominalValue][triple.predicate.nominalValue].push(object);\n\n\n                });\n\n                console.log(\"built jsonld\")\n\n                Object\n                    .keys(tempJsonLd)\n                    .map(key => tempJsonLd[key])\n                    .filter(subject => subject[\"http://www.w3.org/1999/02/22-rdf-syntax-ns#first\"] === undefined)\n                    .forEach(subject => {\n\n                        Object.keys(subject)\n                            .filter(predicate => Array.isArray(subject[predicate]))\n                            .forEach(predicate => {\n                                for (let objectIndex in subject[predicate]) {\n                                    let object = subject[predicate][objectIndex];\n                                    if (object[\"@id\"] === undefined) continue;\n\n                                    if (tempJsonLd[object[\"@id\"]] !== undefined && tempJsonLd[object[\"@id\"]][\"http://www.w3.org/1999/02/22-rdf-syntax-ns#first\"] !== undefined) {\n                                        RdfToJsonLD.convertRdfListToArray(tempJsonLd, subject, predicate, objectIndex);\n                                    }\n\n                                }\n\n\n                            })\n                    });\n\n\n                let realJsonLd = [];\n\n                Object.keys(tempJsonLd)\n                    .filter(key => tempJsonLd[key][\"http://www.w3.org/1999/02/22-rdf-syntax-ns#first\"] === undefined)\n                    .forEach(key => realJsonLd.push(tempJsonLd[key]));\n\n                console.log(\"done with list\")\n\n\n                resolve(realJsonLd);\n\n            }, \"\", null, graph);\n\n\n\n        });\n    }\n\n}\n\n\n\n\nexport default RdfToJsonLD;"]}